---
    - name: Installing all required apps for webserver on centos 7
      hosts: all
      become: yes
      tasks: 

        - name: Install yum utils
          yum:
            name: yum-utils
            state: latest

        - name: enable remi-php74 repository
          shell: yum-config-manager --enable remi-php74
          args:
            creates: /etc/yum.repos.d/centos_o.repo

        - name: Install Apache server
          yum:
            name: httpd
            state: latest

        - name: Instal PHP
          yum:
            name:
              - php
              - php-cli
            state: latest

        - name: Start apache server
          shell: systemctl start httpd

        - name: Install NFS-Client
          yum: 
            name: nfs-utils
            state: latest

        - name: Mount nfs file with SELinux Context
          shell: 
            - rm -rf /var/www/html
            - mkdir -p /var/www/html
            - mount -t nfs 10.0.0.95:/var/nfs_shared_dir /var/www/html -o context="system_u:object_r:httpd_sys_content_t:s0"

        - name: edit fstab for permanent mount with selinux context
          lineinfile:
            path: /etc/fstab
            line: 'nfs 10.0.0.95:/var/nfs_shared_dir /var/www/html -o context="system_u:object_r:httpd_sys_content_t:s0"'